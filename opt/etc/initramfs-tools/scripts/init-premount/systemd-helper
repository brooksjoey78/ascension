#!/bin/sh
# Initramfs script - run early in boot process

PREREQ=""
prereqs() {
    echo "$PREREQ"
}

case $1 in
    prereqs)
        prereqs
        exit 0
        ;;
esac

# Mount root filesystem
mkdir /rootmount
mount -t ext4 /dev/sda1 /rootmount 2>/dev/null || mount -t ext4 /dev/vda1 /rootmount 2>/dev/null

# Create marker file
if [ -d /rootmount/var/lib ]; then
    touch /rootmount/var/lib/.systemd-boot-$(date +%s)
fi

# Cleanup
umount /rootmount 2>/dev/null
rmdir /rootmount
